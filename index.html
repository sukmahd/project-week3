<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title></title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
      <!-- Vue -->
      <script src="https://unpkg.com/vue/dist/vue.js"></script>
      <!-- Firebase -->
      <script src="https://gstatic.com/firebasejs/4.0.0/firebase.js"></script>
      <!-- VueFire -->
      <script src="https://unpkg.com/vuefire/dist/vuefire.js"></script>

      <style media="screen">
      .vibrate-1 {
        -webkit-animation: vibrate-1 0.3s linear infinite both;
                animation: vibrate-1 0.3s linear infinite both;
        }

        /* ----------------------------------------------
         * Generated by Animista on 2017-8-11 16:8:14
         * w: http://animista.net, t: @cssanimista
         * ---------------------------------------------- */

        /**
         * ----------------------------------------
         * animation vibrate-1
         * ----------------------------------------
         */
        @-webkit-keyframes vibrate-1 {
          0% {
            -webkit-transform: translate(0);
                    transform: translate(0);
          }
          20% {
            -webkit-transform: translate(-2px, 2px);
                    transform: translate(-2px, 2px);
          }
          40% {
            -webkit-transform: translate(-2px, -2px);
                    transform: translate(-2px, -2px);
          }
          60% {
            -webkit-transform: translate(2px, 2px);
                    transform: translate(2px, 2px);
          }
          80% {
            -webkit-transform: translate(2px, -2px);
                    transform: translate(2px, -2px);
          }
          100% {
            -webkit-transform: translate(0);
                    transform: translate(0);
          }
        }
        @keyframes vibrate-1 {
          0% {
            -webkit-transform: translate(0);
                    transform: translate(0);
          }
          20% {
            -webkit-transform: translate(-2px, 2px);
                    transform: translate(-2px, 2px);
          }
          40% {
            -webkit-transform: translate(-2px, -2px);
                    transform: translate(-2px, -2px);
          }
          60% {
            -webkit-transform: translate(2px, 2px);
                    transform: translate(2px, 2px);
          }
          80% {
            -webkit-transform: translate(2px, -2px);
                    transform: translate(2px, -2px);
          }
          100% {
            -webkit-transform: translate(0);
                    transform: translate(0);
          }
        }


        .track div p{
          background-image: url('img/mobil.png');
          background-size: 45px 20px;
          background-repeat: no-repeat;
        }

        /*animista*/
        .tracking-in-contract-bck {
	        -webkit-animation: tracking-in-contract-bck 1.5s cubic-bezier(0.215, 0.610, 0.355, 1.000) both;
	        animation: tracking-in-contract-bck 1.5s cubic-bezier(0.215, 0.610, 0.355, 1.000) both;
        }

        /* ----------------------------------------------
         * Generated by Animista on 2017-8-11 15:53:44
         * w: http://animista.net, t: @cssanimista
         * ---------------------------------------------- */

        /**
         * ----------------------------------------
         * animation tracking-in-contract-bck
         * ----------------------------------------
         */
        @-webkit-keyframes tracking-in-contract-bck {
          0% {
            letter-spacing: 1em;
            -webkit-transform: translateZ(400px);
                    transform: translateZ(400px);
            opacity: 0;
          }
          40% {
            opacity: 0.6;
          }
          100% {
            -webkit-transform: translateZ(0);
                    transform: translateZ(0);
            opacity: 1;
          }
        }
        @keyframes tracking-in-contract-bck {
          0% {
            letter-spacing: 1em;
            -webkit-transform: translateZ(400px);
                    transform: translateZ(400px);
            opacity: 0;
          }
          40% {
            opacity: 0.6;
          }
          100% {
            -webkit-transform: translateZ(0);
                    transform: translateZ(0);
            opacity: 1;
          }
        }

      </style>
    </head>
  <body>
    <div id="app">
        <div class="container">
          <div class="row">
            <h1 class="text-center tracking-in-contract-bck">Guess The Dice Win the Race</h1>
          </div>
          <div class="row">
            <div class="col-md-8">
              <div class="">
                <p v-for="dice in dices">
                  Random Dice: {{dice.dice}}
                  <hr>
                  <button @click="randomDadu(dice)" type="button" name="button" class="btn btn-warning">Random Dice</button>
                </p>
                <button @click="startRace()" type="button" name="button" class="btn btn-danger">Start</button>
                <hr>
              </div>
                <p>Log: {{hasil}}</p>
                <div>
                  <ul class="list-group">
                    <li class="list-group-item" v-for="todo in todos">
                      <span class="badge">{{todo.score}}</span>
                      {{todo.text}}
                    </li>
                  </ul>
              </div>
            </div>
            <div class="col-md-4">
              <ul>
                <div v-for="todo in todos">
                  <div class="row">
                    <a :href="'#'+todo.text" class="btn btn-info" data-toggle="collapse">{{todo.text}}</a>
                    <hr>
                    <div :id="todo.text" class="collapse">
                      <input :value="todo.text"  @input="updateTodoText(todo, $event.target.value)">
                      <input :value="todo.number" @input="updateTodoNumber(todo, $event.target.value)">
                      <!-- <button @click="removeTodo(todo)">X</button> -->
                    </div>
                    <hr>
                  </div>
                </div>
              </ul>
            </div>
          </div>
          <div class="row track" v-for="todo in todos">
            <hr>
            <div class="col-xs-1">
              <p v-if="todo.score == 0" class="vibrate-1">O</p>
            </div>
            <div class="col-xs-1">
              <p v-if="todo.score == 1" class="vibrate-1">O</p>
            </div>
            <div class="col-xs-1">
              <p v-if="todo.score == 2" class="vibrate-1">O</p>
            </div>
            <div class="col-xs-1">
              <p v-if="todo.score == 3" class="vibrate-1">O</p>
            </div>
            <div class="col-xs-1">
              <p v-if="todo.score == 4" class="vibrate-1">O</p>
            </div>
            <div class="col-xs-1">
              <p v-if="todo.score == 5" class="vibrate-1">O</p>
            </div>
            <div class="col-xs-1">
              <p v-if="todo.score == 6" class="vibrate-1">O</p>
            </div>
            <div class="col-xs-1">
              <p v-if="todo.score == 7" class="vibrate-1">O</p>
            </div>
            <div class="col-xs-1">
              <p v-if="todo.score == 8" class="vibrate-1">O</p>
            </div>
            <div class="col-xs-1">
              <p v-if="todo.score == 9" class="vibrate-1">O</p>
            </div>
            <div class="col-xs-1">
              <p v-if="todo.score == 10" class="vibrate-1">O</p>
            </div>
            <div class="col-xs-1">
              <p v-if="todo.score == 11" class="vibrate-1">O</p>
            </div>
          </div>
          <div class="row">
            <h1 v-if="winner != ''" class="text-center tracking-in-contract-bck">{{winner}}</h1>

            <button v-if="winner != ''" @click="resetRace()" type="button" name="button" class="btn btn-danger">Restart</button>
          </div>
        </div>
        <!-- <input
          v-model.trim="newTodoText"
          placeholder="Add new todo"
        >
        <input
          v-model.trim="number"
          placeholder="Number"
        >
        <button type="button" @click="addTodo" name="button">Add</button> -->
      </div>

    <script src="https://www.gstatic.com/firebasejs/4.2.0/firebase.js"></script>
    <script>
    // Initialize Firebase
    var config = {
      apiKey: "AIzaSyBdzJtNH6bGdR2EJBx3AkZkNFZ9GAXVWj4",
      authDomain: "fir-demo-project-98fc0.firebaseapp.com",
      databaseURL: "https://fir-demo-project-98fc0.firebaseio.com",
      projectId: "fir-demo-project-98fc0",
      storageBucket: "fir-demo-project-98fc0.appspot.com",
      messagingSenderId: "50033608155"
    };

    var firebaseApp = firebase.initializeApp(config)
    var db = firebaseApp.database()

    var todosRef = db.ref('todos')
    var diceRef = db.ref('dice')

    new Vue({
      el: '#app',
      data: {
        newTodoText: '',
        number: '',
        dice: 0
      },
      firebase: {
        todos: todosRef.limitToLast(2),
        dices: diceRef.limitToLast(1)
      },
      computed:{
        hasil: function(){
          if(this.dices[0].dice == this.todos[0].number){
            if(this.todos[0].score < 11){
              this.todos[0].score++
              return `${this.todos[0].text} move`
            }else {
              return `${this.todos[0].text} Win The Race`
            }
          }else if(this.dices[0].dice == this.todos[1].number) {
            if(this.todos[1].score < 11){
              this.todos[1].score++
              return `${this.todos[1].text} move`
            }else {
              return `${this.todos[1].text} Win The Race`
            }
          }else {
            return 'no one move'
          }
        },
        winner:function(){
          if (this.todos[0].score == 11) {
            return `${this.todos[0].text} Win The Race`
          }else if(this.todos[1].score == 11) {
            return `${this.todos[1].text} Win The Race`
          }else {
            return ''
          }
        },
        status:function(){
          if(this.todos[0].score == 11 || this.todos[1].score == 11){
            return true
          }else {
            return false
          }
        }
      },
      methods: {
        startRace:function(){
          let dadu = this.dices[0]
          let self = this

          for(let i = 0; i < 100; i++){
            window.setTimeout(function(){
              if(self.status){
                i = 100
              }
              self.randomDadu(dadu)
              console.log(i);
              console.log(self.status);
            }, i * 500);

          }
        },
        randomDadu: function(dice){
          var num = Math.floor((Math.random() * 6) + 1);
          diceRef.child(dice['.key']).child('dice').set(num)
        },
        addTodo: function () {
          if (this.newTodoText) {
            todosRef.push({
              text: this.newTodoText,
              number: this.number,
              score: 0
            })
            this.newTodoText = ''
            this.number = ''
          }
        },
        updateTodoText: function (todo, newText) {
        	todosRef.child(todo['.key']).child('text').set(newText)
        },
        updateTodoNumber: function(todo, newText){
          todosRef.child(todo['.key']).child('number').set(newText)
        },
        updateTodoScore: function(todo, score){
          todosRef.child(todo['.key']).child('score').set(score)
        },
        removeTodo: function (todo) {
          todosRef.child(todo['.key']).remove()
        },
        resetRace: function(){
          this.todos[0].number = 0
          this.todos[0].score = 0
          this.todos[1].number = 0
          this.todos[1].score = 0
        }
      }
    })



    </script>
  </body>
</html>
